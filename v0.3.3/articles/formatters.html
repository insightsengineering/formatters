<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to the formatters package • formatters</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to the formatters package">
<meta property="og:description" content="formatters">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">formatters</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/formatters.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/insightsengineering/formatters" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to the formatters package</h1>
                        <h4 data-toc-skip class="author">Gabriel
Becker</h4>
            
            <h4 data-toc-skip class="date">2022-08-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/insightsengineering/formatters/blob/HEAD/vignettes/formatters.Rmd" class="external-link"><code>vignettes/formatters.Rmd</code></a></small>
      <div class="hidden name"><code>formatters.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="formatters">formatters<a class="anchor" aria-label="anchor" href="#formatters"></a>
</h2>
<p>The <code>formatters</code> package provides two core pieces of
functionality, both relatead to ASCII rendering:</p>
<ol style="list-style-type: decimal">
<li>
<code>format_value</code> provides the ability to format single- and
multi-valued elements into ASCII display-ready strings</li>
<li>the <code>matrix_form</code> framework provides generics for
implementing ASCII rendering support for display tables</li>
</ol>
<p>Both of these featuresets are used in the <code>rtables</code>
package.</p>
</div>
<div class="section level2">
<h2 id="formatting-values">Formatting values<a class="anchor" aria-label="anchor" href="#formatting-values"></a>
</h2>
<p>The core motivation for <code>formatters</code> is the rendering of
reporting tables into ASCII. In this context a ‘value’ is the raw
content that to appear in a single table cell. Most commonly this is a
numeric vector of length 1, 2 or – occasionally – 3.</p>
<div class="section level3">
<h3 id="format-labels">Format labels<a class="anchor" aria-label="anchor" href="#format-labels"></a>
</h3>
<p><code>formatters</code> ships with a large number of pre-defined
formats appropriate for rendering values into ASCII strings. These
existing formats are specified by their labels. We can see the list of
these by calling the <code>list_valid_format_labels</code> function:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/list_valid_format_labels.html">list_valid_format_labels</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>$`1d`
 [1] "xx"                 "xx."                "xx.x"              
 [4] "xx.xx"              "xx.xxx"             "xx.xxxx"           
 [7] "xx%"                "xx.%"               "xx.x%"             
[10] "xx.xx%"             "xx.xxx%"            "(N=xx)"            
[13] "&gt;999.9"             "&gt;999.99"            "x.xxxx | (&lt;0.0001)"

$`2d`
 [1] "xx / xx"            "xx. / xx."          "xx.x / xx.x"       
 [4] "xx.xx / xx.xx"      "xx.xxx / xx.xxx"    "xx (xx%)"          
 [7] "xx (xx.%)"          "xx (xx.x%)"         "xx (xx.xx%)"       
[10] "xx. (xx.%)"         "xx.x (xx.x%)"       "xx.xx (xx.xx%)"    
[13] "(xx, xx)"           "(xx., xx.)"         "(xx.x, xx.x)"      
[16] "(xx.xx, xx.xx)"     "(xx.xxx, xx.xxx)"   "(xx.xxxx, xx.xxxx)"
[19] "xx - xx"            "xx.x - xx.x"        "xx.xx - xx.xx"     
[22] "xx (xx)"            "xx. (xx.)"          "xx.x (xx.x)"       
[25] "xx.xx (xx.xx)"      "xx (xx.)"           "xx (xx.x)"         
[28] "xx (xx.xx)"         "xx.x, xx.x"         "xx.x to xx.x"      

$`3d`
[1] "xx. (xx. - xx.)"          "xx.x (xx.x - xx.x)"      
[3] "xx.xx (xx.xx - xx.xx)"    "xx.xxx (xx.xxx - xx.xxx)"

attr(,"info")
[1] "xx does not modify the element, and xx. rounds a number to 0 digits"</code></pre>
<p>Each of these labels desceribes how the incoming (possibly
multi-element) raw value will be formatted. <code>xx</code> indicates
that an element of the value will be printed as is, with no
modification. <code>xx.</code> indicates that a numeric value element
will be rounded to 0 decimal places, <code>xx.x</code> indicates
rounding to 1 decimal place, etc.</p>
</div>
<div class="section level3">
<h3 id="formatting-values-1">Formatting values<a class="anchor" aria-label="anchor" href="#formatting-values-1"></a>
</h3>
<p>Values are formatted via calls to <code>format_value</code>, like
so:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/format_value.html">format_value</a></span><span class="op">(</span><span class="fl">5.1235</span>, format <span class="op">=</span> <span class="st">"xx.xx"</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] "5.12"</code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/format_value.html">format_value</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.2355</span>, <span class="fl">2.6789</span><span class="op">)</span>, <span class="st">"(xx.xx, xx.xx)"</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] "(1.24, 2.68)"</code></pre>
</div>
</div>
<div class="section level2">
<h2 id="table-rendering-framework">Table Rendering Framework<a class="anchor" aria-label="anchor" href="#table-rendering-framework"></a>
</h2>
<p><strong>Advanced Usage Only</strong> These features are supported,
and in fact are used in <code>rtables</code> and the experimental
<code>rlistings</code>. That said, the API is currently very low-level
and tailored to what <code>rtables</code> and <code>rlistings</code>
need. How useful this is to other table frameworks may vary.</p>
<p>The second major piece of functionality in <code>formatters</code> is
the ability to render tables into ASCII (and thus directly to the
terminal) based on a so-called <code>MatrixPrintForm</code>
representation of the table.</p>
<p>To hook up <code>rtables</code>-style ASCII display for your tables,
it suffices to export a method for the exported <code>matrix_form</code>
generic <code>formatters</code> provides. This method must return a
<code>MatrixPrintForm</code> object representing your table.</p>
<p>We can build a baby example method for <code>data.frames</code> to
illustrate this process:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## pagdfrow supports a large number of pieces of information regarding</span></span>
<span><span class="co">## siblings and what information should be repeated after a pagination.</span></span>
<span><span class="co">## we ignore all that here and just give the absolutely crucial info:</span></span>
<span><span class="co">## nm (name), lab (label), rnum (absolute row position), pth ("path"),</span></span>
<span><span class="co">## extent (how many lines it takes up), rclass ("class of row")</span></span>
<span><span class="va">fake_pagdf_row</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span>, <span class="va">rnms</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">nm</span> <span class="op">&lt;-</span> <span class="va">rnms</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="fu"><a href="../reference/pagdfrow.html">pagdfrow</a></span><span class="op">(</span>nm <span class="op">=</span> <span class="va">nm</span>, lab <span class="op">=</span> <span class="va">nm</span>, rnum <span class="op">=</span> <span class="va">i</span>, pth <span class="op">=</span> <span class="va">nm</span>, extent <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>             rclass <span class="op">=</span> <span class="st">"NA"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">matrix_form.data.frame</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">fmts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">df</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="fu"><a href="../reference/lab_name.html">obj_format</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="st">"xx"</span> <span class="kw">else</span> <span class="fu"><a href="../reference/lab_name.html">obj_format</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">bodystrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">fmt</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">format_value</span>, format <span class="op">=</span> <span class="va">fmt</span><span class="op">)</span></span>
<span>    <span class="op">}</span>, x <span class="op">=</span> <span class="va">df</span>, fmt <span class="op">=</span> <span class="va">fmts</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">rnms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">rnms</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">rnms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">cnms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">strings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="va">cnms</span><span class="op">)</span>,</span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">rnms</span>, <span class="va">bodystrs</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">fnr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">strings</span><span class="op">)</span></span>
<span>    <span class="va">fnc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">strings</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co">## center alignment for column labels, left alignment for everything else</span></span>
<span>    <span class="va">aligns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="st">"center"</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="st">"left"</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">fnc</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>   </span>
<span>    <span class="co">## build up fake pagination df, </span></span>
<span>    <span class="va">rowdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_pagdf.html">basic_pagdf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/MatrixPrintForm.html">matrix_print_form</a></span><span class="op">(</span>strings <span class="op">=</span> <span class="va">strings</span>,</span>
<span>                      aligns <span class="op">=</span> <span class="va">aligns</span>,</span>
<span>                      spans <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, nrow <span class="op">=</span> <span class="va">fnr</span>, ncol <span class="op">=</span> <span class="va">fnc</span><span class="op">)</span>,</span>
<span>                      formats <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                      row_info <span class="op">=</span> <span class="va">rowdf</span>,</span>
<span>                      has_topleft <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                      nlines_header <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                      nrow_header <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span>                      </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="../reference/tostring.html">toString</a></span><span class="op">(</span><span class="fu">matrix_form.data.frame</span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>                      mpg    cyl   disp    hp    drat    wt     qsec    vs   am   gear   carb
—————————————————————————————————————————————————————————————————————————————————————————————
Mazda RX4             21     6     160     110   3.9    2.62    16.46   0    1    4      4   
Mazda RX4 Wag         21     6     160     110   3.9    2.875   17.02   0    1    4      4   
Datsun 710            22.8   4     108     93    3.85   2.32    18.61   1    1    4      1   
Hornet 4 Drive        21.4   6     258     110   3.08   3.215   19.44   1    0    3      1   
Hornet Sportabout     18.7   8     360     175   3.15   3.44    17.02   0    0    3      2   
Valiant               18.1   6     225     105   2.76   3.46    20.22   1    0    3      1   
Duster 360            14.3   8     360     245   3.21   3.57    15.84   0    0    3      4   
Merc 240D             24.4   4     146.7   62    3.69   3.19    20      1    0    4      2   
Merc 230              22.8   4     140.8   95    3.92   3.15    22.9    1    0    4      2   
Merc 280              19.2   6     167.6   123   3.92   3.44    18.3    1    0    4      4   
Merc 280C             17.8   6     167.6   123   3.92   3.44    18.9    1    0    4      4   
Merc 450SE            16.4   8     275.8   180   3.07   4.07    17.4    0    0    3      3   
Merc 450SL            17.3   8     275.8   180   3.07   3.73    17.6    0    0    3      3   
Merc 450SLC           15.2   8     275.8   180   3.07   3.78    18      0    0    3      3   
Cadillac Fleetwood    10.4   8     472     205   2.93   5.25    17.98   0    0    3      4   
Lincoln Continental   10.4   8     460     215   3      5.424   17.82   0    0    3      4   
Chrysler Imperial     14.7   8     440     230   3.23   5.345   17.42   0    0    3      4   
Fiat 128              32.4   4     78.7    66    4.08   2.2     19.47   1    1    4      1   
Honda Civic           30.4   4     75.7    52    4.93   1.615   18.52   1    1    4      2   
Toyota Corolla        33.9   4     71.1    65    4.22   1.835   19.9    1    1    4      1   
Toyota Corona         21.5   4     120.1   97    3.7    2.465   20.01   1    0    3      1   
Dodge Challenger      15.5   8     318     150   2.76   3.52    16.87   0    0    3      2   
AMC Javelin           15.2   8     304     150   3.15   3.435   17.3    0    0    3      2   
Camaro Z28            13.3   8     350     245   3.73   3.84    15.41   0    0    3      4   
Pontiac Firebird      19.2   8     400     175   3.08   3.845   17.05   0    0    3      2   
Fiat X1-9             27.3   4     79      66    4.08   1.935   18.9    1    1    4      1   
Porsche 914-2         26     4     120.3   91    4.43   2.14    16.7    0    1    5      2   
Lotus Europa          30.4   4     95.1    113   3.77   1.513   16.9    1    1    5      2   
Ford Pantera L        15.8   8     351     264   4.22   3.17    14.5    0    1    5      4   
Ferrari Dino          19.7   6     145     175   3.62   2.77    15.5    0    1    5      6   
Maserati Bora         15     8     301     335   3.54   3.57    14.6    0    1    5      8   
Volvo 142E            21.4   4     121     109   4.11   2.78    18.6    1    1    4      2   </code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Gabriel Becker, Adrian Waddell, F. Hoffmann-La Roche AG.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
